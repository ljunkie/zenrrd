$(document).ready(function(){var b={onSelect:zoomit,onChange:displayCoords};$("#graph").zoom_rrd(b)});function zoomit(b){var o=parseQuery(window.location.search),g=parseInt(o.start),d=parseInt(o.end)-g,r=$("#graph").width()-82,d=d/r,r=b.x-66,y=b.x2-66;0>r&&(r=0);b=parseInt(d*r+g);g=parseInt(d*y+g);d=parseInt((new Date).getTime()/1E3);parseInt(g)>parseInt(d)&&(g=d);var w="?start="+b+"&end="+g;$.each(o,function(b,d){"start"!=b&&"end"!=b&&"zo"!=b&&(w+="&"+b+"="+d)});window.location=w}
function parseQuery(b){var o={};if(!b)return o;for(var b=b.split(/[;&]/),g=0;g<b.length;g++){var d=b[g].split("=");if(d&&2==d.length){var r=unescape(d[0]),r=r.replace(/\?/g,""),d=unescape(d[1]),d=d.replace(/\+/g," ");o[r]=d}}return o}function displayCoords(b){$("#x1").val(b.x);$("#y1").val(b.y);$("#x2").val(b.x2);$("#y2").val(b.y2);$("#w").val(b.w);$("#h").val(b.h)}
(function(b){b.zoom_rrd=function(o,g){function d(a){a=b(a).offset();return[a.left,a.top]}function r(a){return[a.pageX-P[0],a.pageY-P[1]]}function y(t){"object"!==typeof t&&(t={});a=b.extend(a,t);b.each(["onChange","onSelect","onRelease"],function(b,t){"function"!==typeof a[t]&&(a[t]=function(){})})}function w(a,b,d){var f=a.width(),c=a.height();f>b&&0<b&&(f=b,c=b/a.width()*a.height());c>d&&0<d&&(c=d,f=d/a.height()*a.width());s=a.width()/f;v=a.height()/c;a.width(f).height(c)}function H(a){return{x:a.x*
s,y:a.y*v,x2:a.x2*s,y2:a.y2*v,w:a.w*s,h:a.h*v}}function da(){var b=u.getFixed();b.w>a.minSelect[0]&&b.h>a.minSelect[1]?(n.enableHandles(),n.done()):n.release();D.setCursor(a.allowSelect?"crosshair":"default")}function ea(a){u.setCurrent(a);n.update()}function Y(b){b=[b[0]/s,b[1]/v,b[2]/s,b[3]/v];u.setPressed([b[0],b[1]]);u.setCurrent([b[2],b[3]]);n.update();a.onSelect.call(z,H(u.getFixed()));n.enableHandles()}function Z(){a.disabled=!0;n.disableHandles();n.setCursor("default");D.setCursor("default")}
function aa(){a.disabled=!1;T()}function U(t,d,f){d=d||a.bgColor;a.bgFade&&b.fx.step.hasOwnProperty("backgroundColor")&&a.fadeTime&&!f?t.animate({backgroundColor:d},{queue:!1,duration:a.fadeTime}):t.css("backgroundColor",d)}function T(b){a.allowResize?b?n.enableOnly():n.enableHandles():n.disableHandles();D.setCursor(a.allowSelect?"crosshair":"default");a.hasOwnProperty("trueSize")&&(s=a.trueSize[0]/j,v=a.trueSize[1]/f);a.hasOwnProperty("setSelect")&&(Y(a.setSelect),n.done(),delete a.setSelect);B.refresh();
a.bgColor!=ba&&(U(a.shade?B.getShades():A,a.shade?a.shadeColor||a.bgColor:a.bgColor),ba=a.bgColor);I!=a.bgOpacity&&(I=a.bgOpacity,a.shade?B.refresh():n.setBgOpacity(I));J=a.maxSize[0]||0;K=a.maxSize[1]||0;L=a.minSize[0]||0;M=a.minSize[1]||0;a.hasOwnProperty("outerImage")&&(p.attr("src",a.outerImage),delete a.outerImage);n.refresh()}var a=b.extend({},b.zoom_rrd.defaults),P,Q=!1;b.browser.msie&&"6"===b.browser.version.split(".")[0]&&(Q=!0);"object"!==typeof o&&(o=b(o)[0]);"object"!==typeof g&&(g={});
y(g);var V={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},q=b(o),ca=!0;if("IMG"==o.tagName){if(0!=q[0].width&&0!=q[0].height)q.width(q[0].width),q.height(q[0].height);else{var W=new Image;W.src=q[0].src;q.width(W.width);q.height(W.height)}var p=q.clone().removeAttr("id").css(V).show();p.width(q.width());p.height(q.height());q.after(p).hide()}else p=q.css(V).show(),ca=!1,null===a.shade&&(a.shade=!0);w(p,a.boxWidth,a.boxHeight);var j=p.width(),f=p.height(),
A=b("<div />").width(j).height(f).addClass(a.baseClass+"-holder").css({position:"relative",backgroundColor:a.bgColor}).insertAfter(q).append(p);a.addClass&&A.addClass(a.addClass);var C=b("<div />"),X=b("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),N=b("<div />").width("100%").height("100%").css("zIndex",320),E=b("<div />").css({position:"absolute",zIndex:600}).insertBefore(p).append(X,N);ca&&(C=b("<img />").attr("src",p.attr("src")).css(V).width(j).height(f),
X.append(C));Q&&E.css({overflowY:"hidden"});var Q=j-82,F=function(){var d=b("<div></div>").addClass(a.baseClass+"-tracker");b.browser.msie&&d.css({opacity:0,backgroundColor:"white"});return d}().width(Q+5).height(105).css({position:"absolute",top:"30px",left:"65px",zIndex:290}).mousedown(function(b){if(a.disabled||!a.allowSelect)return false;R=true;P=d(p);n.disableHandles();D.setCursor("crosshair");var f=r(b);u.setPressed(f);n.update();D.activateHandlers(ea,da);b.stopPropagation();b.preventDefault();
return false}),ba=a.bgColor,I=a.bgOpacity,J,K,L,M,s,v,R;P=d(p);var u=function(){function b(){if(!a.aspectRatio){var i=m-c,x=k-e;J&&Math.abs(i)>J&&(m=i>0?c+J:c-J);K&&Math.abs(x)>K&&(k=x>0?e+K:e-K);M/v&&Math.abs(x)<M/v&&(k=x>0?e+M/v:e-M/v);L/s&&Math.abs(i)<L/s&&(m=i>0?c+L/s:c-L/s);if(c<0){m=m-c;c=c-c}if(e<0){k=k-e;e=e-e}if(m<0){c=c-m;m=m-m}if(k<0){e=e-k;k=k-k}if(m>j){i=m-j;c=c-i;m=m-i}if(k>f){i=k-f;e=e-i;k=k-i}if(c>j){i=c-f;k=k-i;e=e-i}if(e>f){i=e-f;k=k-i;e=e-i}return n(g(c,e,m,k))}var i=a.aspectRatio,
x=a.minSize[0]/s,d=a.maxSize[0]/s,t=m-c,S=k-e,l=Math.abs(t),h=Math.abs(S);d===0&&(d=j*10);if(l/h<i){l=k;h=h*i;h=t<0?c-h:h+c;if(h<0){h=0;l=Math.abs((h-c)/i);l=S<0?e-l:l+e}else if(h>j){h=j;l=Math.abs((h-c)/i);l=S<0?e-l:l+e}}else{h=m;l=l/i;l=S<0?e-l:e+l;if(l<0){l=0;h=Math.abs((l-e)*i);h=t<0?c-h:h+c}else if(l>f){l=f;h=Math.abs(l-e)*i;h=t<0?c-h:h+c}}if(h>c){h-c<x?h=c+x:h-c>d&&(h=c+d);l=l>e?e+(h-c)/i:e-(h-c)/i}else if(h<c){c-h<x?h=c-x:c-h>d&&(h=c-d);l=l>e?e+(c-h)/i:e-(c-h)/i}if(h<0){c=c-h;h=0}else if(h>
j){c=c-(h-j);h=j}if(l<0){e=e-l;l=0}else if(l>f){e=e-(l-f);l=f}return n(g(c,e,h,l))}function d(a){a[0]<0&&(a[0]=0);a[1]<0&&(a[1]=0);a[0]>j&&(a[0]=j);a[1]>f&&(a[1]=f);return[a[0],a[1]]}function g(a,b,c,e){var d=a,l=c,h=b,f=e;if(c<a){d=c;l=a}if(e<b){h=e;f=b}return[d,h,l,f]}function n(a){return{x:a[0],y:a[1],x2:a[2],y2:a[3],w:a[2]-a[0],h:a[3]-a[1]}}var c=0,e=0,m=0,k=0,p,o;return{flipCoords:g,setPressed:function(a){a=d(a);m=c=a[0];k=e=a[1]},setCurrent:function(a){a=d(a);p=a[0]-m;o=a[1]-k;m=a[0];k=a[1]},
getOffset:function(){return[p,o]},moveOffset:function(a){var b=a[0],a=a[1];0>c+b&&(b=b-(b+c));0>e+a&&(a=a-(a+e));f<k+a&&(a=a+(f-(k+a)));j<m+b&&(b=b+(j-(m+b)));c=c+b;m=m+b;e=e+a;k=k+a},getCorner:function(a){var c=b();switch(a){case "ne":return[c.x2,c.y];case "nw":return[c.x,c.y];case "se":return[c.x2,c.y2];case "sw":return[c.x,c.y2]}},getFixed:b}}(),B=function(){var d,g,o,q;function c(){return e(u.getFixed())}function e(a){o.css({left:a.x+"px",width:a.w+"px",height:a.y+"px"});q.css({top:a.y2+"px",
left:a.x+"px",width:a.w+"px",height:f-a.y2+"px"});g.css({left:a.x2+"px",width:j-a.x2+"px"});d.css({width:a.x+"px"})}function m(){return b("<div />").css({position:"absolute",backgroundColor:a.shadeColor||a.bgColor}).appendTo(G)}function k(){if(!O){O=true;G.insertBefore(p);c();n.setBgOpacity(1,0,1);C.hide();r(a.shadeColor||a.bgColor,1);n.isAwake()?i(a.bgOpacity,1):i(1,1)}}function r(a,b){U(x(),a,b)}function s(){if(O){G.remove();C.show();O=false;if(n.isAwake())n.setBgOpacity(a.bgOpacity,1,1);else{n.setBgOpacity(1,
1,1);n.disableHandles()}U(A,0,1)}}function i(b,c){O&&(a.bgFade&&!c?G.animate({opacity:1-b},{queue:false,duration:a.fadeTime}):G.css({opacity:1-b}))}function x(){return G.children()}var O=false,G=b("<div />").css({position:"absolute",zIndex:240,opacity:0});o=m();d=m().height(f);g=m().height(f);q=m();return{update:c,updateRaw:e,getShades:x,setBgColor:r,enable:k,disable:s,resize:function(a,b){d.css({height:b+"px"});g.css({height:b+"px"})},refresh:function(){a.shade?k():s();n.isAwake()&&i(a.bgOpacity)},
opacity:i}}(),n=function(){function d(c){var e,f;for(f=0;f<c.length;f++){switch(c[f]){case "n":e="hline";break;case "s":e="hline bottom";break;case "e":e="vline right";break;case "w":e="vline"}var i=e,i=b("<div />").css({position:"absolute",opacity:a.borderOpacity}).addClass(a.baseClass+"-"+i);X.append(i)}}function f(a){var b;for(b=0;b<a.length;b++);}function g(){var a=u.getFixed();u.setPressed([a.x,a.y]);u.setCurrent([a.x2,a.y2]);n()}function n(a){if(j)return c(a)}function c(b){var c=u.getFixed(),
d=c.h;E.width(c.w).height(d);var d=c.x,f=c.y;a.shade||C.css({top:-f+"px",left:-d+"px"});E.css({top:f+"px",left:d+"px"});a.shade&&B.updateRaw(c);if(!j){E.show();a.shade?B.opacity(I):e(I,true);j=true}b?a.onSelect.call(z,H(c)):a.onChange.call(z,H(c))}function e(b,c,e){if(j||c)a.bgFade&&!e?p.animate({opacity:b},{queue:false,duration:a.fadeTime}):p.css("opacity",b)}function m(){i=true;if(a.allowResize){N.show();return true}}function k(){i=false;N.hide()}function o(a){void 0===a?k():m()}var j,i=false;b.isArray(a.createHandles)&&
f(a.createHandles);a.drawBorders&&b.isArray(a.createBorders)&&d(a.createBorders);k();return{updateVisible:n,update:c,release:function(){k();E.hide();a.shade?B.opacity(1):e(1);j=false;a.onRelease.call(z)},refresh:g,isAwake:function(){return j},enableHandles:m,enableOnly:function(){i=true},showHandles:function(){i&&N.show()},disableHandles:k,animMode:o,setBgOpacity:e,done:function(){o(false);g()}}}(),D=function(){function d(a){g(r(a));return false}function f(c){c.preventDefault();c.stopPropagation();
if(R){R=false;j(r(c));n.isAwake()&&a.onSelect.call(z,H(u.getFixed()));F.css({zIndex:290});b(document).unbind(".zoom_rrd");g=function(){};j=function(){}}return false}var g=function(){},j=function(){},c=a.trackDocument;c||F.mousemove(d).mouseup(f).mouseout(f);p.before(F);return{activateHandlers:function(a,m){R=true;g=a;j=m;F.css({zIndex:450});c&&b(document).bind("mousemove.zoom_rrd",d).bind("mouseup.zoom_rrd",f);return false},setCursor:function(a){F.css("cursor",a)}}}();(function(){var a=b('<input type="radio" />').css({position:"fixed",
left:"-120px",width:"12px"});b("<div />").css({position:"absolute",overflow:"hidden"}).append(a)})();N.hide();T(!0);var z={setImage:function(b,d){Z();var g=new Image;g.onload=function(){var n=g.height,c=a.boxWidth,e=a.boxHeight;p.width(g.width).height(n);p.attr("src",b);C.attr("src",b);w(p,c,e);j=p.width();f=p.height();C.width(j).height(f);F.width(j+bound*2).height(f+bound*2);A.width(j).height(f);B.resize(j,f);aa();typeof d==="function"&&d.call(z)};g.src=b},setSelect:Y,setOptions:function(a){y(a);
T()},tellSelect:function(){return H(u.getFixed())},tellScaled:function(){return u.getFixed()},setClass:function(b){A.removeClass().addClass(a.baseClass+"-holder").addClass(b)},disable:Z,enable:aa,cancel:function(){n.done();D.activateHandlers(null,null)},destroy:function(){A.remove();q.show();b(o).removeData("zoom_rrd")},getBounds:function(){return[j*s,f*v]},getWidgetSize:function(){return[j,f]},getScaleFactor:function(){return[s,v]},getOptions:function(){return a},ui:{holder:A,selection:E}};b.browser.msie&&
A.bind("selectstart",function(){return false});q.data("zoom_rrd",z);return z};b.fn.zoom_rrd=function(o,g){var d;this.each(function(){if(b(this).data("zoom_rrd")){if("api"===o)return b(this).data("zoom_rrd");b(this).data("zoom_rrd").setOptions(o)}else"IMG"==this.tagName?b.zoom_rrd.Loader(this,function(){b(this).css({display:"block",visibility:"hidden"});d=b.zoom_rrd(this,o);b.isFunction(g)&&g.call(d)}):(b(this).css({display:"block",visibility:"hidden"}),d=b.zoom_rrd(this,o),b.isFunction(g)&&g.call(d))});
return this};b.zoom_rrd.Loader=function(o,g,d){function r(){w.complete?(y.unbind(".jcloader"),b.isFunction(g)&&g.call(w)):window.setTimeout(r,50)}var y=b(o),w=y[0];y.bind("load.jcloader",r).bind("error.jcloader",function(){y.unbind(".jcloader");b.isFunction(d)&&d.call(w)});w.complete&&b.isFunction(g)&&(y.unbind(".jcloader"),g.call(w))};b.zoom_rrd.defaults={allowSelect:!0,allowResize:!0,trackDocument:!0,baseClass:"zoom_rrd",addClass:null,bgColor:"black",bgOpacity:0.6,bgFade:!1,borderOpacity:0.4,handleOpacity:0.5,
handleSize:7,aspectRatio:0,createHandles:"n,s,e,w,nw,ne,se,sw".split(","),createBorders:["n","s","e","w"],drawBorders:!0,fixedSupport:!0,shade:null,boxWidth:0,boxHeight:0,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){}}})(jQuery);
