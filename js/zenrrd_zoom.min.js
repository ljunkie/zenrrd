$(document).ready(function(){var b={onSelect:zoomit,onChange:displayCoords};$("#graph").zoom_rrd(b)});function zoomit(b){var k=parseQuery(window.location.search),h=parseInt(k.start),l=parseInt(k.end)-h,u=$("#graph").width()-82,l=l/u,u=b.x-66,y=b.x2-66;0>u&&(u=0);b=parseInt(l*u+h);h=parseInt(l*y+h);l=parseInt((new Date).getTime()/1E3);parseInt(h)>parseInt(l)&&(h=l);var v="?start="+b+"&end="+h;$.each(k,function(b,h){"start"!=b&&"end"!=b&&"zo"!=b&&(v+="&"+b+"="+h)});window.location=v}
function displayCoords(b){$("#x1").val(b.x);$("#y1").val(b.y);$("#x2").val(b.x2);$("#y2").val(b.y2);$("#w").val(b.w);$("#h").val(b.h)}
(function(b){b.zoom_rrd=function(k,h){function l(a){a=b(a).offset();return[a.left,a.top]}function u(a){return[a.pageX-P[0],a.pageY-P[1]]}function y(B){"object"!==typeof B&&(B={});a=b.extend(a,B);b.each(["onChange","onSelect","onRelease"],function(B,b){"function"!==typeof a[b]&&(a[b]=function(){})})}function v(a,b,e){var f=a.width(),c=a.height();f>b&&0<b&&(f=b,c=b/a.width()*a.height());c>e&&0<e&&(c=e,f=e/a.height()*a.width());r=a.width()/f;s=a.height()/c;a.width(f).height(c)}function H(a){return{x:a.x*
r,y:a.y*s,x2:a.x2*r,y2:a.y2*s,w:a.w*r,h:a.h*s}}function da(){var b=t.getFixed();b.w>a.minSelect[0]&&b.h>a.minSelect[1]?(f.enableHandles(),f.done()):f.release();E.setCursor(a.allowSelect?"crosshair":"default")}function ea(a){t.setCurrent(a);f.update()}function Y(b){b=[b[0]/r,b[1]/s,b[2]/r,b[3]/s];t.setPressed([b[0],b[1]]);t.setCurrent([b[2],b[3]]);f.update();a.onSelect.call(z,H(t.getFixed()));f.enableHandles()}function Z(){a.disabled=!0;f.disableHandles();f.setCursor("default");E.setCursor("default")}
function aa(){a.disabled=!1;T()}function U(B,e,f){e=e||a.bgColor;a.bgFade&&b.fx.step.hasOwnProperty("backgroundColor")&&a.fadeTime&&!f?B.animate({backgroundColor:e},{queue:!1,duration:a.fadeTime}):B.css("backgroundColor",e)}function T(b){a.allowResize?b?f.enableOnly():f.enableHandles():f.disableHandles();E.setCursor(a.allowSelect?"crosshair":"default");a.hasOwnProperty("trueSize")&&(r=a.trueSize[0]/o,s=a.trueSize[1]/e);a.hasOwnProperty("setSelect")&&(Y(a.setSelect),f.done(),delete a.setSelect);C.refresh();
a.bgColor!=ba&&(U(a.shade?C.getShades():A,a.shade?a.shadeColor||a.bgColor:a.bgColor),ba=a.bgColor);I!=a.bgOpacity&&(I=a.bgOpacity,a.shade?C.refresh():f.setBgOpacity(I));J=a.maxSize[0]||0;K=a.maxSize[1]||0;L=a.minSize[0]||0;M=a.minSize[1]||0;a.hasOwnProperty("outerImage")&&(p.attr("src",a.outerImage),delete a.outerImage);f.refresh()}var a=b.extend({},b.zoom_rrd.defaults),P,Q=!1;b.browser.msie&&"6"===b.browser.version.split(".")[0]&&(Q=!0);"object"!==typeof k&&(k=b(k)[0]);"object"!==typeof h&&(h={});
y(h);var V={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},q=b(k),ca=!0;if("IMG"==k.tagName){if(0!=q[0].width&&0!=q[0].height)q.width(q[0].width),q.height(q[0].height);else{var W=new Image;W.src=q[0].src;q.width(W.width);q.height(W.height)}var p=q.clone().removeAttr("id").css(V).show();p.width(q.width());p.height(q.height());q.after(p).hide()}else p=q.css(V).show(),ca=!1,null===a.shade&&(a.shade=!0);v(p,a.boxWidth,a.boxHeight);var o=p.width(),e=p.height(),
A=b("<div />").width(o).height(e).addClass(a.baseClass+"-holder").css({position:"relative",backgroundColor:a.bgColor}).insertAfter(q).append(p);a.addClass&&A.addClass(a.addClass);var D=b("<div />"),X=b("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),N=b("<div />").width("100%").height("100%").css("zIndex",320),F=b("<div />").css({position:"absolute",zIndex:600}).insertBefore(p).append(X,N);ca&&(D=b("<img />").attr("src",p.attr("src")).css(V).width(o).height(e),
X.append(D));Q&&F.css({overflowY:"hidden"});var Q=o-82,G=function(){var e=b("<div></div>").addClass(a.baseClass+"-tracker");b.browser.msie&&e.css({opacity:0,backgroundColor:"white"});return e}().width(Q+5).height(e).css({position:"absolute",top:"0px",left:"65px",zIndex:290}).mousedown(function(b){if(a.disabled||!a.allowSelect)return false;R=true;P=l(p);f.disableHandles();E.setCursor("crosshair");var e=u(b);t.setPressed(e);f.update();E.activateHandlers(ea,da);b.stopPropagation();b.preventDefault();
return false}),ba=a.bgColor,I=a.bgOpacity,J,K,L,M,r,s,R;P=l(p);var t=function(){function b(){if(!a.aspectRatio){var j=m-c,w=i-d;J&&Math.abs(j)>J&&(m=j>0?c+J:c-J);K&&Math.abs(w)>K&&(i=w>0?d+K:d-K);M/s&&Math.abs(w)<M/s&&(i=w>0?d+M/s:d-M/s);L/r&&Math.abs(j)<L/r&&(m=j>0?c+L/r:c-L/r);if(c<0){m=m-c;c=c-c}if(d<0){i=i-d;d=d-d}if(m<0){c=c-m;m=m-m}if(i<0){d=d-i;i=i-i}if(m>o){j=m-o;c=c-j;m=m-j}if(i>e){j=i-e;d=d-j;i=i-j}if(c>o){j=c-e;i=i-j;d=d-j}if(d>e){j=d-e;i=i-j;d=d-j}return p(h(c,d,m,i))}var j=a.aspectRatio,
w=a.minSize[0]/r,f=a.maxSize[0]/r,x=m-c,S=i-d,n=Math.abs(x),g=Math.abs(S);f===0&&(f=o*10);if(n/g<j){n=i;g=g*j;g=x<0?c-g:g+c;if(g<0){g=0;n=Math.abs((g-c)/j);n=S<0?d-n:n+d}else if(g>o){g=o;n=Math.abs((g-c)/j);n=S<0?d-n:n+d}}else{g=m;n=n/j;n=S<0?d-n:d+n;if(n<0){n=0;g=Math.abs((n-d)*j);g=x<0?c-g:g+c}else if(n>e){n=e;g=Math.abs(n-d)*j;g=x<0?c-g:g+c}}if(g>c){g-c<w?g=c+w:g-c>f&&(g=c+f);n=n>d?d+(g-c)/j:d-(g-c)/j}else if(g<c){c-g<w?g=c-w:c-g>f&&(g=c-f);n=n>d?d+(c-g)/j:d-(c-g)/j}if(g<0){c=c-g;g=0}else if(g>
o){c=c-(g-o);g=o}if(n<0){d=d-n;n=0}else if(n>e){d=d-(n-e);n=e}return p(h(c,d,g,n))}function f(a){a[0]<0&&(a[0]=0);a[1]<0&&(a[1]=0);a[0]>o&&(a[0]=o);a[1]>e&&(a[1]=e);return[a[0],a[1]]}function h(a,b,c,d){var f=a,e=c,g=b,i=d;if(c<a){f=c;e=a}if(d<b){g=d;i=b}return[f,g,e,i]}function p(a){return{x:a[0],y:a[1],x2:a[2],y2:a[3],w:a[2]-a[0],h:a[3]-a[1]}}var c=0,d=0,m=0,i=0,l,k;return{flipCoords:h,setPressed:function(a){a=f(a);m=c=a[0];i=d=a[1]},setCurrent:function(a){a=f(a);l=a[0]-m;k=a[1]-i;m=a[0];i=a[1]},
getOffset:function(){return[l,k]},moveOffset:function(a){var b=a[0],a=a[1];0>c+b&&(b=b-(b+c));0>d+a&&(a=a-(a+d));e<i+a&&(a=a+(e-(i+a)));o<m+b&&(b=b+(o-(m+b)));c=c+b;m=m+b;d=d+a;i=i+a},getCorner:function(a){var c=b();switch(a){case "ne":return[c.x2,c.y];case "nw":return[c.x,c.y];case "se":return[c.x2,c.y2];case "sw":return[c.x,c.y2]}},getFixed:b}}(),C=function(){var h,l,k,q;function c(){return d(t.getFixed())}function d(a){k.css({left:a.x+"px",width:a.w+"px",height:a.y+"px"});q.css({top:a.y2+"px",
left:a.x+"px",width:a.w+"px",height:e-a.y2+"px"});l.css({left:a.x2+"px",width:o-a.x2+"px"});h.css({width:a.x+"px"})}function m(){return b("<div />").css({position:"absolute",backgroundColor:a.shadeColor||a.bgColor}).appendTo(x)}function i(){if(!O){O=true;x.insertBefore(p);c();f.setBgOpacity(1,0,1);D.hide();r(a.shadeColor||a.bgColor,1);f.isAwake()?j(a.bgOpacity,1):j(1,1)}}function r(a,b){U(w(),a,b)}function s(){if(O){x.remove();D.show();O=false;if(f.isAwake())f.setBgOpacity(a.bgOpacity,1,1);else{f.setBgOpacity(1,
1,1);f.disableHandles()}U(A,0,1)}}function j(b,c){O&&(a.bgFade&&!c?x.animate({opacity:1-b},{queue:false,duration:a.fadeTime}):x.css({opacity:1-b}))}function w(){return x.children()}var O=false,x=b("<div />").css({position:"absolute",zIndex:240,opacity:0});k=m();h=m().height(e);l=m().height(e);q=m();return{update:c,updateRaw:d,getShades:w,setBgColor:r,enable:i,disable:s,resize:function(a,b){h.css({height:b+"px"});l.css({height:b+"px"})},refresh:function(){a.shade?i():s();f.isAwake()&&j(a.bgOpacity)},
opacity:j}}(),f=function(){function f(c){var d,e;for(e=0;e<c.length;e++){switch(c[e]){case "n":d="hline";break;case "s":d="hline bottom";break;case "e":d="vline right";break;case "w":d="vline"}var i=d,i=b("<div />").css({position:"absolute",opacity:a.borderOpacity}).addClass(a.baseClass+"-"+i);X.append(i)}}function e(a){var b;for(b=0;b<a.length;b++);}function h(){var a=t.getFixed();t.setPressed([a.x,a.y]);t.setCurrent([a.x2,a.y2]);l()}function l(a){if(k)return c(a)}function c(b){var c=t.getFixed(),
e=c.h;F.width(c.w).height(e);var e=c.x,f=c.y;a.shade||D.css({top:-f+"px",left:-e+"px"});F.css({top:f+"px",left:e+"px"});a.shade&&C.updateRaw(c);if(!k){F.show();a.shade?C.opacity(I):d(I,true);k=true}b?a.onSelect.call(z,H(c)):a.onChange.call(z,H(c))}function d(b,c,d){if(k||c)a.bgFade&&!d?p.animate({opacity:b},{queue:false,duration:a.fadeTime}):p.css("opacity",b)}function m(){j=true;if(a.allowResize){N.show();return true}}function i(){j=false;N.hide()}function o(a){void 0===a?i():m()}var k,j=false;b.isArray(a.createHandles)&&
e(a.createHandles);a.drawBorders&&b.isArray(a.createBorders)&&f(a.createBorders);i();return{updateVisible:l,update:c,release:function(){i();F.hide();a.shade?C.opacity(1):d(1);k=false;a.onRelease.call(z)},refresh:h,isAwake:function(){return k},enableHandles:m,enableOnly:function(){j=true},showHandles:function(){j&&N.show()},disableHandles:i,animMode:o,setBgOpacity:d,done:function(){o(false);h()}}}(),E=function(){function e(a){k(u(a));return false}function h(c){c.preventDefault();c.stopPropagation();
if(R){R=false;l(u(c));f.isAwake()&&a.onSelect.call(z,H(t.getFixed()));G.css({zIndex:290});b(document).unbind(".zoom_rrd");k=function(){};l=function(){}}return false}var k=function(){},l=function(){},c=a.trackDocument;c||G.mousemove(e).mouseup(h).mouseout(h);p.before(G);return{activateHandlers:function(a,f){R=true;k=a;l=f;G.css({zIndex:450});c&&b(document).bind("mousemove.zoom_rrd",e).bind("mouseup.zoom_rrd",h);return false},setCursor:function(a){G.css("cursor",a)}}}();(function(){var a=b('<input type="radio" />').css({position:"fixed",
left:"-120px",width:"12px"});b("<div />").css({position:"absolute",overflow:"hidden"}).append(a)})();N.hide();T(!0);var z={setImage:function(b,f){Z();var h=new Image;h.onload=function(){var k=h.height,c=a.boxWidth,d=a.boxHeight;p.width(h.width).height(k);p.attr("src",b);D.attr("src",b);v(p,c,d);o=p.width();e=p.height();D.width(o).height(e);G.width(o+bound*2).height(e+bound*2);A.width(o).height(e);C.resize(o,e);aa();typeof f==="function"&&f.call(z)};h.src=b},setSelect:Y,setOptions:function(a){y(a);
T()},tellSelect:function(){return H(t.getFixed())},tellScaled:function(){return t.getFixed()},setClass:function(b){A.removeClass().addClass(a.baseClass+"-holder").addClass(b)},disable:Z,enable:aa,cancel:function(){f.done();E.activateHandlers(null,null)},destroy:function(){A.remove();q.show();b(k).removeData("zoom_rrd")},getBounds:function(){return[o*r,e*s]},getWidgetSize:function(){return[o,e]},getScaleFactor:function(){return[r,s]},getOptions:function(){return a},ui:{holder:A,selection:F}};b.browser.msie&&
A.bind("selectstart",function(){return false});q.data("zoom_rrd",z);return z};b.fn.zoom_rrd=function(k,h){var l;this.each(function(){if(b(this).data("zoom_rrd")){if("api"===k)return b(this).data("zoom_rrd");b(this).data("zoom_rrd").setOptions(k)}else"IMG"==this.tagName?b.zoom_rrd.Loader(this,function(){b(this).css({display:"block",visibility:"hidden"});l=b.zoom_rrd(this,k);b.isFunction(h)&&h.call(l)}):(b(this).css({display:"block",visibility:"hidden"}),l=b.zoom_rrd(this,k),b.isFunction(h)&&h.call(l))});
return this};b.zoom_rrd.Loader=function(k,h,l){function u(){v.complete?(y.unbind(".jcloader"),b.isFunction(h)&&h.call(v)):window.setTimeout(u,50)}var y=b(k),v=y[0];y.bind("load.jcloader",u).bind("error.jcloader",function(){y.unbind(".jcloader");b.isFunction(l)&&l.call(v)});v.complete&&b.isFunction(h)&&(y.unbind(".jcloader"),h.call(v))};b.zoom_rrd.defaults={allowSelect:!0,allowResize:!0,trackDocument:!0,baseClass:"zoom_rrd",addClass:null,bgColor:"black",bgOpacity:0.6,bgFade:!1,borderOpacity:0.4,handleOpacity:0.5,
handleSize:7,aspectRatio:0,createHandles:"n,s,e,w,nw,ne,se,sw".split(","),createBorders:["n","s","e","w"],drawBorders:!0,fixedSupport:!0,shade:null,boxWidth:0,boxHeight:0,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){}}})(jQuery);
